#+title: Emacs Config
#+STARTUP: overview
#+HTML_HEAD: <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">

Denne Emacs-konfigurasjonen baserer seg p√• [[https://github.com/doomemacs/doomemacs][Doom Emacs]]-rammeverket, som deler inn all konfigurasjon til ~init.el~, ~packages.el~, og ~config.el~.

Dette er en [[https://orgmode.org/manual/Extracting-Source-Code.html][literal konfigurasjonsfil]], som betyr at all konfigurasjon defineres i denne artikkelen, ogs√• hentes innholdet i kodeblokkene her ut til de riktige konfigfilene n√•r man √∏nsker √• oppdatere. Med andre ord skriver man README-en f√∏rst, ogs√• utg√•r all konfig automatisk ut fra den. 

* Profiling av oppstartstid


Om oppstart av Emacs g√•r treigt, pleier jeg √• legge inn disse to linjene manuelt henholdsvis topp og bunn av ~config.el~. Da f√•r man en callstack-rapport med ~M-x profiler-report~ der det st√•r ganske tydelig hva som tar opp all tiden:

#+begin_src elisp
(profiler-start 'cpu)
(profiler-stop)
#+end_src


test:

* Toppniv√• headere
** packages.el
#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el

;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/packages.el
#+end_src

~;; -*- no-byte-compile: t; -*-~ sier at Emacs ikke skal kompilere filen til en ~.elc~-fil. Det blir vanligvis gjort for at ting skal kj√∏re fortere

** config.el
#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src

** init.el

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/init.el
;;; init.el -*- lexical-binding: t; -*-
#+end_src

* Secrets

Sensitiv info som passord, personlige notatnavn, og jobbrelaterte referanser som ikke passer seg p√• et offentlig repo legges til en ~.emacs.secrets~-fil som jeg synkroniserer privat, utenfor denne configen.

~when~-uttrykket p√• f√∏rste linje passer p√• at Emacs ikke krasjer hvis ~.secrets~-fila skulle mangle

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(when (file-exists-p "~/.emacs.secrets")
  (load-file "~/.emacs.secrets"))
#+end_src



* init.el

Dette er hele ~init.el~-fila slik den er originalt etter Doom Emacs-rammeverket. Har ikke kommet over noen god grunn til √• dele den opp

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/init.el
(doom! :input
       ;;bidi              ; (tfel ot) thgir etirw uoy gnipleh
       ;;chinese
       ;;japanese
       ;;layout            ; auie,ctsrnm is the superior home row

       :completion
       ;;company           ; the ultimate code completion backend
       (corfu +orderless)  ; complete with cap(f), cape and a flying feather!
       ;;helm              ; the *other* search engine for love and life
       ;;ido               ; the other *other* search engine...
       ;;ivy               ; a search engine for love and life
       vertico           ; the search engine of the future

       :ui
       ;;deft              ; notational velocity for Emacs
       doom              ; what makes DOOM look the way it does
       doom-dashboard    ; a nifty splash screen for Emacs
       ;;doom-quit         ; DOOM quit-message prompts when you quit Emacs
       (emoji +unicode)  ; üôÇ
       hl-todo           ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW
       ;;indent-guides     ; highlighted indent columns
       ;;ligatures         ; ligatures and symbols to make your code pretty again
       ;;minimap           ; show a map of the code on the side
       modeline          ; snazzy, Atom-inspired modeline, plus API
       ;;nav-flash         ; blink cursor line after big motions
       ;;neotree           ; a project drawer, like NERDTree for vim
       ophints           ; highlight the region an operation acts on
       (popup +defaults)   ; tame sudden yet inevitable temporary windows
       smooth-scroll     ; So smooth you won't believe it's not butter
       ;;tabs              ; a tab bar for Emacs
       treemacs          ; a project drawer, like neotree but cooler
       ;;unicode           ; extended unicode support for various languages
       (vc-gutter +pretty) ; vcs diff in the fringe
       vi-tilde-fringe   ; fringe tildes to mark beyond EOB
       ;;window-select     ; visually switch windows
       workspaces        ; tab emulation, persistence & separate workspaces
       zen               ; distraction-free coding or writing

       :editor
       (evil +everywhere); come to the dark side, we have cookies
       file-templates    ; auto-snippets for empty files
       fold              ; (nigh) universal code folding
       ;;(format +onsave)  ; automated prettiness
       ;;god               ; run Emacs commands without modifier keys
       ;;lispy             ; vim for lisp, for people who don't like vim
       ;;multiple-cursors  ; editing in many places at once
       ;;objed             ; text object editing for the innocent
       ;;parinfer          ; turn lisp into python, sort of
       ;;rotate-text       ; cycle region at point between text candidates
       snippets          ; my elves. They type so I don't have to
       ;;word-wrap         ; soft wrapping with language-aware indent

       :emacs
       (dired +dirvish +icons)             ; making dired pretty [functional]
       electric          ; smarter, keyword-based electric-indent
       ;;eww               ; the internet is gross
       ;;ibuffer           ; interactive buffer management
       undo              ; persistent, smarter undo for your inevitable mistakes
       vc                ; version-control and Emacs, sitting in a tree

       :term
       ;;eshell            ; the elisp shell that works everywhere
       ;;shell             ; simple shell REPL for Emacs
       ;;term              ; basic terminal emulator for Emacs
       vterm             ; the best terminal emulation in Emacs

       :checkers
       syntax              ; tasing you for every semicolon you forget
       ;;(spell +flyspell) ; tasing you for misspelling mispelling
       ;;grammar           ; tasing grammar mistake every you make

       :tools
       ansible
       ;;biblio            ; Writes a PhD for you (citation needed)
       ;;collab            ; buffers with friends
       ;;debugger          ; FIXME stepping through code, to help you add bugs
       ;;direnv
       ;;docker
       ;;editorconfig      ; let someone else argue about tabs vs spaces
       ;;ein               ; tame Jupyter notebooks with emacs
       (eval +overlay)     ; run code, run (also, repls)
       lookup              ; navigate your code and its documentation
       ;;lsp               ; M-x vscode
       magit             ; a git porcelain for Emacs
       ;;make              ; run make tasks from Emacs
       ;;pass              ; password manager for nerds
       pdf               ; pdf enhancements
       terraform         ; infrastructure as code
       ;;tmux              ; an API for interacting with tmux
       ;;tree-sitter       ; syntax and parsing, sitting in a tree...
       ;;upload            ; map local to remote projects via ssh/ftp

       :os
       (:if (featurep :system 'macos) macos)  ; improve compatibility with macOS
       ;;tty               ; improve the terminal Emacs experience

       :lang
       ;;agda              ; types of types of types of types...
       ;;beancount         ; mind the GAAP
       ;;(cc +lsp)         ; C > C++ == 1
       ;;clojure           ; java with a lisp
       ;;common-lisp       ; if you've seen one lisp, you've seen them all
       ;;coq               ; proofs-as-programs
       ;;crystal           ; ruby at the speed of c
       ;;csharp            ; unity, .NET, and mono shenanigans
       ;;data              ; config/data formats
       ;;(dart +flutter)   ; paint ui and not much else
       ;;dhall
       ;;elixir            ; erlang done right
       ;;elm               ; care for a cup of TEA?
       emacs-lisp        ; drown in parentheses
       ;;erlang            ; an elegant language for a more civilized age
       ;;ess               ; emacs speaks statistics
       ;;factor
       ;;faust             ; dsp, but you get to keep your soul
       ;;fortran           ; in FORTRAN, GOD is REAL (unless declared INTEGER)
       ;;fsharp            ; ML stands for Microsoft's Language
       ;;fstar             ; (dependent) types and (monadic) effects and Z3
       ;;gdscript          ; the language you waited for
       ;;(go +lsp)         ; the hipster dialect
       ;;(graphql +lsp)    ; Give queries a REST
       ;;(haskell +lsp)    ; a language that's lazier than I am
       ;;hy                ; readability of scheme w/ speed of python
       ;;idris             ; a language you can depend on
       ;;json              ; At least it ain't XML
       ;;(java +lsp)       ; the poster child for carpal tunnel syndrome
       ;;javascript        ; all(hope(abandon(ye(who(enter(here))))))
       ;;julia             ; a better, faster MATLAB
       ;;kotlin            ; a better, slicker Java(Script)
       ;;latex             ; writing papers in Emacs has never been so fun
       ;;lean              ; for folks with too much to prove
       ;;ledger            ; be audit you can be
       ;;lua               ; one-based indices? one-based indices
       markdown          ; writing docs for people to ignore
       ;;nim               ; python + lisp at the speed of c
       ;;nix               ; I hereby declare "nix geht mehr!"
       ;;ocaml             ; an objective camel
       (org +roam2)               ; organize your plain life in plain text
       ;;php               ; perl's insecure younger brother
       ;;plantuml          ; diagrams for confusing people more
       ;;graphviz          ; diagrams for confusing yourself even more
       ;;purescript        ; javascript, but functional
       ;;python            ; beautiful is better than ugly
       ;;qt                ; the 'cutest' gui framework ever
       ;;racket            ; a DSL for DSLs
       ;;raku              ; the artist formerly known as perl6
       rest              ; Emacs as a REST client
       ;;rst               ; ReST in peace
       ;;(ruby +rails)     ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}
       ;;(rust +lsp)       ; Fe2O3.unwrap().unwrap().unwrap().unwrap()
       ;;scala             ; java, but good
       ;;(scheme +guile)   ; a fully conniving family of lisps
       sh                ; she sells {ba,z,fi}sh shells on the C xor
       ;;sml
       ;;solidity          ; do you need a blockchain? No.
       ;;swift             ; who asked for emoji variables?
       ;;terra             ; Earth and Moon in alignment for performance.
       ;;web               ; the tubeS
       ;;yaml              ; JSON, but readable
       ;;zig               ; C, but simpler

       :email
       ;;(mu4e +org +gmail)
       ;;notmuch
       ;;(wanderlust +gmail)

       :app
       ;;calendar
       ;;emms
       everywhere        ; *leave* Emacs!? You must be joking
       ;;irc               ; how neckbeards socialize
       ;;(rss +org)        ; emacs as an RSS reader

       :config
       ;;literate
       (default +bindings +smartparens))
#+end_src
* packages.el

Her ligger det sm√•pakker som ikke har gjort seg fortjent til egne kapitler

- ~rainbow-mode~ fargelegger hexnumre direkte, f.eks. #EEEE3E.
- ~keyfreq~ gir statistikk p√• hvor ofte kommandoer brukes
- ~verb~ er [[https://github.com/federicotdn/verb][herfra]]. Et alternativ til ~restclient.el~
- ~keycast~ er veldig nyttig for √• se hvilke funksjoner som kalles

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! nyan-mode)
(package! fireplace)
(package! zone-rainbow)
(package! rainbow-mode)
(package! vimgolf)
(package! evil-tutor)
(package! elisp-format)
(package! keyfreq)
(package! verb)
(package! keycast)
(package! activities)
#+end_src

~nyan-mode~ og ~rainbow-mode~ m√• ogs√• aktiveres i ~config.el~ slik:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(nyan-mode 1)

(after! org
  (add-hook 'org-mode-hook #'rainbow-mode))
#+end_src

vimgolf config:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! vimgolf
  (map! :leader
        ;; call vimgolf prompt
        "g v" #'vimgolf
        ;; default bindings as listed in README
        "g V" #'vimgolf-submit))
#+end_src

keyfreq config: Fjerner tracking av scroll-events, for de st√∏yer ned all statistikken.
Fjerner ogs√• ~org-self-insert-command~, som kj√∏res for hvert eneste tastetrykk

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el

(setq keyfreq-excluded-commands
        '(mwheel-scroll
          ultra-scroll
          self-insert-command
          org-self-insert-command))

(setq keyfreq-autosave-timeout 180)
(keyfreq-mode 1)
(keyfreq-autosave-mode 1)
#+end_src
* Consult (s√∏king)

[[https://github.com/minad/consult][Consult]] er ei pakke med s√∏ke- og navigeringskommandoer som f√∏lger med Doom Emacs. Den har mulighet for live preview av filer n√•r man s√∏ker opp et ord, men for meg er det ikke aktivert som standard. Legger til live preview slik:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! consult
  (consult-customize
   +default/search-project
   +default/search-other-project
   +default/search-cwd
   +default/search-other-cwd
   consult-ripgrep
   consult-grep
   consult-git-grep
   :preview-key 'any))
#+end_src

Den viktige linja her er ~:preview-key 'any~. Om jeg forst√•r rett, s√• sier den at for alle s√∏kefunksjonene som listes opp i forkant, s√• skal ethvert tastetrykk ("~any~") trigge preview av valgt fil. Default-innstilling kan man se ved √• sl√• opp verdien p√• ~consult--customize-alist~. Hos meg var alle s√∏kekommandoer satt med ~:preview-key 'SPC-C'~, som betyr at jeg m√• eksplisitt taste SPC-C for √• trigge en preview. 

* Tema

Dette er temaer jeg har lagt til i tillegg til alle som fins i Emacs fra f√∏r.
Siste headline har en ~(setq doom-theme NAVN)~-uttrykk som faktisk velger en av disse

** Kanagawa

Temaet kommer [[https://github.com/emacsmirror/kanagawa-themes][herfra]]. Fargepaletten er inspirert av det japanske [[https://en.wikipedia.org/wiki/The_Great_Wave_off_Kanagawa][Kanagawa-maleriet]]. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! kanagawa-themes)
#+end_src

** Catppuccin

Herfra: [[https://github.com/catppuccin/emacs/][Catppuccin - Soothing pastel theme for Emacs]]

Installerer ~catppuccin~-temaet gjennom ~packages.el~

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! catppuccin-theme)
#+end_src

Deretter m√• det settes i ~config.el~ vha. ~doom-theme~. Temaet kommer i fire varianter (Latte, Frapp√©, Macchiato, Mocha), ogs√• setter en av disse via en "flavor"-string. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq catppuccin-flavor 'mocha)
(setq catppuccin-flavor 'macchiato)
#+end_src

...da jeg la inn dette fikk jeg en feilmelding om *Symbol‚Äôs function definition is void*, som jeg l√∏ste med en blanding av l√∏sningen fra et [[https://github.com/catppuccin/emacs/issues/121][GitHub-issue]] og litt vibe-code fra ChatGPT:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(add-hook 'server-after-make-frame-hook
          (lambda () (when (fboundp 'catppuccin-reload)
                       (catppuccin-reload))))

(when (fboundp 'catppuccin-reload)
  (catppuccin-reload))
#+end_src

#+RESULTS:
: t

** Modus Vivendi
Protesilaos' temaer: https://protesilaos.com/emacs/modus-themes

De er blitt tatt inn som standardtemaer i Emacs, s√• det er bare √• sette dark-versjonen (~modus-vivendi-tinted~) som standard

** Standardtema

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq doom-theme 'modus-vivendi)
#+end_src


* Velkomstskjerm :noexport:
; ~noexport~ fordi jeg ikke bruker velkomstskjerm for tida 

F√∏lger hlissner sin guide herfra: https://discourse.doomemacs.org/t/how-to-change-your-splash-screen/57

Fjerner f√∏rst alle widgetene:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(remove-hook '+doom-dashboard-functions #'doom-dashboard-widget-shortmenu)
#+end_src

Det funker fint. Da kommer det bare en ASCII-DOOM-logo, en setning om at "Doom loaded 160 packages...", og en logo som lenker til Doom-GitHub.

Fjerner den lille GitHub-emojien som lenker til Doom-repoet:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(remove-hook '+doom-dashboard-functions #'doom-dashboard-widget-footer)
#+end_src

Fjerner til slutt den setningen om at "Doom loaded X modules in Y seconds":

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(remove-hook '+doom-dashboard-functions #'doom-dashboard-widget-loaded)
#+end_src

Legger til et eget bilde i stedet for DOOM-ASCII-art-en

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq fancy-splash-image "~/repos/dotfiler/doom/emacs.png")
#+end_src

Da st√•r jeg igjen med kun et bilde p√• velkomstskjermen

* Generell Emacs config
** St√∏rrelse p√• vinduet ved oppstart

Dette er for √• f√• Emacs til √• starte opp med en hensiktsmessig st√∏rrelse p√• vinduet, slik at jeg slipper √• resize-e det hver gang Emacs starter opp. 

For √• se st√∏rrelsen p√• vinduet akkurat n√•, kan man evaluere denne:

#+begin_src emacs-lisp
(format "Width: %d, Height: %d" (frame-width) (frame-height))
#+end_src

#+RESULTS:
: Width: 168, Height: 44

WSL og Linux oppf√∏rer seg forskjellig, s√• de trenger hver sin setting:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(cond
 ;; ---  WSL  ---
 ((and (eq system-type 'gnu/linux) (getenv "WSLENV"))
  (add-to-list 'initial-frame-alist '(width . 90))
  (add-to-list 'initial-frame-alist '(height . 60)))

 ;; --- Linux ---
 ((eq system-type 'gnu/linux)
  (add-to-list 'initial-frame-alist '(width . 83))
  (add-to-list 'initial-frame-alist '(height . 44))))
#+end_src

Ved f√∏rste √∏yekast ser det ut som om vinduet settes til √• v√¶re nesten dobbelt s√• bredt som det er h√∏yt, f√∏r man skj√∏nner at h√∏yden oppgis i linjer, og bredden oppgis i antall characters. Det gir mening n√•r man f√•r h√∏re at Emacs m√•ler alt i tekst, og rektangelet som omslutter en bokstav p√• datamaskiner er mye h√∏yere enn det er bredt.


** Kill ring max
Emacs' lagrer utklippstavlen over tid, men standard maxlengde for historikken er 120 entries, som ikke er s√• mye. √òker denne en del:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq kill-ring-max 1000)
#+end_src

** Fjern word wrap

Det er egentlig fint at ord wrapper p√• h√∏yresiden av skjermen, men ~word-wrap~ gj√∏r ogs√• at URL-er starter med et linjeskift, og det er irriterende. H√•per √• finne ut en m√•te √• fjerne bare newline p√• venstresiden, samtidig som jeg kan beholde vanlig word wrap p√• h√∏yresiden

Det er uansett raskt √• bytte mellom modusene med ~M-x toggle-ord-wrap~. Setter default til √• ikke bryte:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
;(setq word-wrap nil)
(add-hook 'doom-after-init-modules-hook
  (lambda () (setq-default word-wrap nil)))
#+end_src

** Nerd fonts

[[https://www.nerdfonts.com/][Nerd Fonts]] brukes aktivt i Doom Emacs til alle mulige sm√• symboler rundt omkring. 

P√• Linux kan man installere Nerd Fonts med ~M-x install-nerd-fonts~, men Emacs som kj√∏rer under WSL/Windows eller p√• Termux/Android klarer ikke det. Da m√• man i tillegg installere en font selv, ogs√• deretter sette den med ~doom-font~.

Det som er ekstra spennende, er at hele Doom Emacs-korthuset ramler sammen dramatisk hvis man pr√∏ver √• sette ~doom font~ til noe som ikke fins. S√• for √• sikre mot det, ligger ~setq doom-font~ etter en ~when~-clause som sjekker om den fins f√∏r vi setter den

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(when (find-font (font-spec :family "FantasqueSansMNerdFontMono"))
  (setq doom-font (font-spec :family "FantasqueSansMNerdFontMono" :size 14)))
#+end_src

Installasjon av nerd fonts kan gj√∏res s√•nn:

1. Last ned en font-variasjon av Nerd Fonts, f.eks. ~Fantasque~, [[https://www.nerdfonts.com/font-downloads][herfra]]
   - [[https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/FantasqueSansMono.zip][Direktelenke til FantasqueSansMono.zip]] 
2. Ekstraher ~.zip~-en og g√• inn i mappa fra kommandolinjen
3. Kj√∏r dette for √• installere fonten: 

#+begin_src shell
mkdir -p ~/.local/share/fonts
cp FantasqueSansMNerdFont-*.ttf ~/.local/share/fonts/
fc-cache -fv
#+end_src 

** Grunnleggende personinfo

Navn og e-post kan finne p√• √• bli printa i eksporterte dokumenter.
Linux, WSL og Android finner p√• forskjellige ting her, og fyller inn hostname o.l. som standard.
S√• jeg setter de eksplisitt her:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq user-full-name "Martin Lillebo"
      user-mail-address "lillebomartin@gmail.com")
#+end_src


** Vindustekst

Dette er linja helt p√• toppen av hele Emacs-GUI-et

Default fra Doom-config er filnavn + "". Fjerner sistnevnte med √• redefinere ~frame-title-format~ til √• bare inneholde buffernavnet

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq frame-title-format '("%b"))
#+end_src

** Fjerne "are you sure you want to close Emacs? (y/n)"
S√•nn:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq confirm-kill-emacs nil)
#+end_src

** Lexical binding

Setter lexical binding som standard, i stedet for dynamic som er (forel√∏pig fortsatt) default standard:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq-default lexical-binding t)
#+end_src

Forskjellen mellom lexical/dynamic binding handler om hvorvidt verdier satt med ~let~ er tilgjengelige for n√∏sta funksjoner eller ikke. Lexical er det som er vanlig ellers, f.eks. i Python. Det er bra forklart her: https://web.archive.org/web/20250409165354/https://www.gnu.org/software/emacs/manual/html_node/eintr/Lexical-vs-Dynamic-Binding-Example.html

** Autolagre buffere

Standardinnstillingen til Emacs er at man √•pner opp fil-innholdet i en uavhengig buffer, ogs√• skrives ikke endringer til filen f√∏r man husker √• lagre med ~SPC b s~. Det glemmer jeg hele tida, s√• denne innstillingen aktiverer autolagring-modus med ~+1~ med 5-sekunders intervall mellom hver lagring


#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq auto-save-visited-interval 5)
(auto-save-visited-mode +1)
#+end_src

** Hurtigtaster
*** ~C-s~ for √• lagre
~SPC b s~ f√∏les un√∏dvendig n√•r man har ~C-s~ i alle andre programmer i hele verden, s√• jeg legger inn sistnvente som hotkey til √• lagre buffer:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :i "C-s" #'save-buffer   ; insert mode
      :n "C-s" #'save-buffer)  ; normal mode
#+end_src

*** ~SPC y k~: yank-from-kill-ring
Bruker denne veldig ofte

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "y k" #'yank-from-kill-ring)
#+end_src
*** ~SPC v s~ for √• markere som kode 

jeg ~markerer~ ofte et helt ord og wrapper det i ~tilde~. Da m√• man skrive "viWS~", som er b√•de blanding av case og et tildesymbol. P√• et norsk tastatur krever det 9 tastetrykk. F√•r denne ned til 3 trykk slik:

bruker ~SPC v s~ fordi den minner meg om den originale versjonen.

~evil-forward-WORD-end~ er den funksjonen som er bundet opp til ~e~ i vanlig ~evil-mode~

Lager i tillegg en versjon som bare kj√∏rer "S ~" n√•r jeg har markert tekst, slik at jeg har en l√∏sning som ogs√• kan h√•ndtere flere ord med mellomrom mellom seg. Da har jeg samme hotkey for normal mode og visual mode. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(define-key evil-normal-state-map (kbd "SPC v s")
  (lambda () (interactive)
    (execute-kbd-macro (kbd "v i W S ~"))
    (evil-forward-WORD-end)))

(define-key evil-visual-state-map (kbd "SPC v s")
  (lambda () (interactive)
    (let ((end-pos (region-end)))
      (execute-kbd-macro (kbd "S ~"))
      (goto-char (+ end-pos 1)))))
#+end_src

** Relative linjenumre
Relative linjenumre gj√∏r det mulig √• hoppe til riktig linje med vim motions

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq display-line-numbers-type 'visual)
#+end_src

Det fins ogs√• et valg som heter ~'relative~, men da f√•r man bufferlinjer i stedet for skjermlinjer. Da slutter Vim-referanser √• virke s√• fort man har en innsnevring i bufferen.

** Fargelegge linjenumre
Standardfargen for linjenumrene er litt for m√∏rke, som er upraktisk n√•r man ofte refererer til de med vimbindings

Standarden er: 

- Foreground: ~#45475a~
- Background: ~#1e1e2e~

Gj√∏r de lysere slik: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(custom-set-faces!
  '(line-number              :foreground "#b8c2dc"))
#+end_src


** Bokmerker

Gj√∏r at bokmerker holder seg lagra p√• tvers av reboots:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq bookmark-save-flag 1)
#+end_src
** Deaktivere ~pg dn~ og ~pg up~
Disse er rett ved piltastene p√• min laptop, og jeg kommer borti de hele tiden. Jeg bruker de ikke til vanlig, s√• jeg bare deaktiverer de:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(with-eval-after-load 'pixel-scroll
  (defalias 'pixel-scroll-interpolate-down 'ignore)
  (defalias 'pixel-scroll-interpolate-up 'ignore))
#+end_src

uten ~with-eval-after-load~ s√• funker ikke ~defalias~-uttrykkene, selv om de legges helt nederst i ~config.el~
** Garbage collection-meldinger :noexport:

Setter p√• denne for √• m√• melding i echo-area n√•r garbage collection starter og slutter. Bare fordi det er interessant √• f√• et inntrykk av hvor ofte det skjer: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq garbage-collection-messages t)
#+end_src

** G√• ut av insert mode etter idletid

Hvis jeg er i idle mode lengre en 30 sek uten aktivitet, s√• g√•r den ut av insert og inn i normal mode.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(run-with-idle-timer 30 t
  (lambda ()
      (when (evil-insert-state-p)
            (evil-normal-state))))
#+end_src

** Gjennomsiktig bakgrunn og dimming

Alle kule utviklere har delvis gjennomsiktig bakgrunn

~add-to-list~ er der for √• gi samme transparens til sekund√¶re Emacs-vinduer, eller "frames" i Emacs-sjargong. Det skjer ikke s√• ofte, men f.eks. Emacs Everywhere-buffervinduer er selvst√•ende vinduer som ikke blir transparente uten denne innstillingen

Det var n√• jeg m√•tte l√¶re meg hva en "frame" er, i tillegg til "window" og "buffer" 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(set-frame-parameter (selected-frame) 'alpha '(94 . 94))
(add-to-list 'default-frame-alist '(alpha . (94 . 94)))
#+end_src
** Avslutte med riktig kommando

Jeg lukker ofte Emacs med ~SPC w q~ uten √• mene det, da jeg bruker den mye for √• lukke vinduer. Om det bare er ett vikdu igjen, s√• avsluttes Emacs. Fjerner den siste regelen slik:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/evil-quit-advice (orig-fun &rest args)
  "Stopper evil-exit fra √• lukke Emacs"
    (if (= (length (window-list)) 1)
          (message "Lukk Emacs med SPC q q")
              (apply orig-fun args)))

(advice-add 'evil-quit :around #'my/evil-quit-advice)
#+end_src

** ultra-scroll

Denne tror jeg er standard i Doom Emacs. Men den gir feilmelding ved oppstart i Android, s√• jeg deaktiverer den p√• mobil:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(when (eq system-type 'android)
    (advice-add 'ultra-scroll-mode :override #'ignore))
#+end_src

* Vim/evil og annen navigasjon

Alt som har med Vim-bevegelser og navigasjon √• gj√∏re

** Fjerne uvaner

Et vanlig tips for √• bli flinkere i Vim er √• deaktivere ting som nybegynnere ofte klamrer seg til, for √• tvinge overgang til bedre vaner. En av tingene er √• bruke piltastene. Egentlig i det hele tatt, men spesielt i insert mode. Starter med √• fjerne de akkurat i insert mode, hvor jeg ofte havner der

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! evil
  (defun my/deaktivere-piltaster ()
    (interactive)
    (message "Piltaster deaktivert."))

  (dolist (key '("<left>" "<right>" "<up>" "<down>"))
    (define-key evil-insert-state-map (kbd key) 'my/deaktivere-piltaster)
    (define-key evil-normal-state-map (kbd key) 'my/deaktivere-piltaster)
    )
  )
#+end_src
** Better-jumper

I ~Vim~ s√• funker ~``~ fint til √• hoppe mellom ~evil-next-line~/~evil-previous-line~ n√•r disse kalles med et tall, f.eks. ~5j~ eller ~10k~. Men ~evil-mode~ inkluderer ikke det.

Jeg brukte litt for mye tid til √• pr√∏ve √• vibe det til √• virke, ogs√• ga jeg opp. Men jeg fant en l√∏sning som heller bruker ~better-jumper~, som Doom har bundet til ~C-o~/~C-i~.

Boilerplate-koden nedenfor her er henta fra denne [[https://www.reddit.com/r/emacs/comments/1mztz6i/share_your_tips_for_fast_movements_and_navigation/][reddittr√•den]], ogs√• har jeg lagt til noen ekstra linjer under "jump scenarios" n√•r jeg vil ha inn flere ting til √• trigge et mark

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package better-jumper

    :custom
    ; this is the key to avoiding conflict with evils jumping stuff
    (better-jumper-use-evil-jump-advice nil)

    :config
    (better-jumper-mode 1)

    ; this lets me toggle between two points. (adapted from evil-jump-backward-swap)
    (evil-define-motion better-jumper-toggle (count)
      (let ((pnt (point)))
        (better-jumper-jump-backward 1)
        (better-jumper-set-jump pnt)))

    ; this is the key here. This advice makes it so you only set a jump point
    ; if you move more than one line with whatever command you call. For example
    ; if you add this advice around evil-next-line, you will set a jump point
    ; if you do 10 j, but not if you just hit j. I did not write this code, I
    ; I found it a while back and updated it to work with better-jumper.
    (defun my-jump-advice (oldfun &rest args)
      (let ((old-pos (point)))
        (apply oldfun args)
        (when (> (abs (- (line-number-at-pos old-pos) (line-number-at-pos (point))))
                  1)
          (better-jumper-set-jump old-pos))))

    ; jump scenarios
    (advice-add 'evil-next-line :around #'my-jump-advice)
    (advice-add 'evil-previous-line :around #'my-jump-advice)
    (advice-add 'helm-swoop :around #'my-jump-advice)
    (advice-add 'evil-goto-definition :around #'my-jump-advice)
    (advice-add 'evil-goto-mark  :around #'my-jump-advice)
    (advice-add 'evil-avy-goto-char-2 :around #'my-jump-advice)
    )
    ; ... whenever you want a new jump scenario just use the above pattern.
#+end_src
** Hurtigtast - Markere til linjeslutt

Jeg markerer veldig okte til slutten av ei linje uten √• ville ta med linjeskift. Lager en hotkey for det:

Med vimbindings kan man oppn√• det med ~vg_~. S√∏kte opp hvilke funksjoner ~v~ og ~g_~ er bundet til, og la de inn i en egen funksjon nedenfor her.

Denne feiler om jeg legger den for h√∏yt i configfila. Pr√∏vde en times tid √• finne ur hvorfor, f√∏r jeg ga opp og la den nederst her:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/visual-to-line-end ()
  (interactive)
  (evil-visual-char)
  (evil-last-non-blank))

(map! :leader
  (:prefix ("v" . "markering")
    :desc "Marker til linjeslutt"
    "g" #'my/visual-to-line-end))
#+end_src





* TUI config :noexport:
Noen ganger er det best √• kj√∏re Emacs i terminalen heller enn som GUI-applikasjon, med ~emacs -nw~. Spesielt som alternativ til √• kj√∏re GUI-applikasjonen ut fra Windows sitt WSL-milj√∏. 

** TUI utklippstavle

Uten ekstra config er utklippstavla til TUI-er generelt uavhengig av OS-et sin tavle, som gj√∏r det veldig keitete √• kopiere og lime tekst mellom terminal og ikke-terminal-programmer

Denne magiske fix-en har jeg stj√•let ordrett herfra: [[https://www.rahuljuliato.com/posts/emacs-clipboard-terminal][emacs-solo-clipboard: A Minimal Clipboard Bridge]]

Den setter opp en fake "pakke", finner ut om det kj√∏res Wayland-Linux, X11-Linux, macOS eller WSL, ogs√• tar den i bruk OS-native utklippstavleprogrammer til √• fungere som bro mellom terminal og resten av maskinen. Holder macOS utkommentert da jeg ikke eier en Mac, men fin √• ha der om det skulle komme en vakker dag hvor det skjer. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package emacs-solo-clipboard
  :ensure nil
  :no-require t
  :defer t
  :init
  (cond
   ;; macOS: use pbcopy/pbpaste
   ;; ((eq system-type 'darwin)
   ;;      (setq interprogram-cut-function
   ;;      	  (lambda (text &optional _)
   ;;      		(let ((process-connection-type nil))
   ;;      		  (let ((proc (start-process "pbcopy" "*Messages*" "pbcopy")))
   ;;      			(process-send-string proc text)
   ;;      			(process-send-eof proc)))))
   ;;      (setq interprogram-paste-function
   ;;      	  (lambda ()
   ;;      		(shell-command-to-string "pbpaste"))))

   ;; WSL (Windows Subsystem for Linux): Use clip.exe for copy and powershell.exe for paste
   ((and (eq system-type 'gnu/linux)
        	 (getenv "WSLENV"))
        (setq interprogram-cut-function
        	  (lambda (text &optional _)
        		(let ((process-connection-type nil))
        		  (let ((proc (start-process "clip.exe" "*Messages*" "clip.exe")))
        			(process-send-string proc text)
        			(process-send-eof proc)))))
        (setq interprogram-paste-function
        	  (lambda ()
        		(string-trim (shell-command-to-string "powershell.exe -command Get-Clipboard")))))

   ;; Linux with wl-copy/wl-paste (Wayland)
   ((and (eq system-type 'gnu/linux) (executable-find "wl-copy"))
	(setq interprogram-cut-function
		  (lambda (text &optional _)
			(let ((process-connection-type nil))
			  (let ((proc (start-process "wl-copy" "*Messages*" "wl-copy")))
				(process-send-string proc text)
				(process-send-eof proc)))))
	(setq interprogram-paste-function
		  (lambda ()
			(shell-command-to-string "wl-paste -n"))))

   ;; Linux with xclip (X11)
   ((and (eq system-type 'gnu/linux) (executable-find "xclip"))
	(setq interprogram-cut-function
		  (lambda (text &optional _)
			(let ((process-connection-type nil))
			  (let ((proc (start-process "xclip" "*Messages*" "xclip" "-selection" "clipboard")))
				(process-send-string proc text)
				(process-send-eof proc)))))
	(setq interprogram-paste-function
		  (lambda ()
			(shell-command-to-string "xclip -selection clipboard -o"))))))
#+end_src



* Utviklermilj√∏
** Parenteser

Aktiverer ~smartparens-mode~ overalt for √• lyse opp motsats-parentesen til den jeg har mark√∏ren p√•:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(show-smartparens-global-mode 1)
#+end_src




* √Öpne URL-er i Firefox p√• alle plattformer

Configen nedenfor gj√∏r at jeg kan trykke p√• en URL og forvente at den √•pnes i Firefox, i b√•de WSL2 p√• Windows, i Android gjennom Termux, og p√• vanlig Linux.

Uten denne configen, s√• Emacs p√• Windows √•pne URL-er i ~eww~-leseren hvis kj√∏res som ~.exe~, og ingensteds gjennom WSL. Og Android-klienten bare klager p√• at det mangler en innstilling og √•pner ingenting.

Trikset er √• utnytte ~system-type~ som returnerer ~gnu/linux~ i WSL og Linux, og ~android~ p√• Android. For √• skille WSL fra Linux er det en ~and~ clause som i tillegg sjekker om milj√∏variablene ~WSLENV~ er satt til noe, for det er den bare i WSL. Kunne sikkert kommet unna med √• bare sjekke ~WSLENV~, men det funker slik det st√•r. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! browse-url
  ;; Default to Firefox everywhere
  (setq browse-url-browser-function 'browse-url-generic)

  (cond
   ;; WSLENV fins bare p√• WSL, alts√• Windows
   ((and (eq system-type 'gnu/linux)
         (getenv "WSLENV"))
    (setq browse-url-generic-program "cmd.exe"
          browse-url-generic-args '("/c" "start" "")))

   ;; --- Linux ---
   ((eq system-type 'gnu/linux)
    (setq browse-url-generic-program "firefox"))

   ;; Android
   ((eq system-type 'android)
    (setq browse-url-generic-program "xdg-open"))))
#+end_src

- Detaljer om WSL-nettleserlinjene:
  - ~cmd.exe /c~: Kj√∏r det som kommer etterp√• i ~cmd.exe~.
  - ~start~: En Windows-builtin som sier at det som f√¥res inn til ~cmd~ skal √•pnes med Windows' standardprogram for det
  - ~""~ trengs fordi den plasseringen i argumentrekkef√∏lga er forbeholdt hva tittelen p√• toppen av programvinduet skal si. Flagget ignoreres vanligvis om det ikke gis inn, men en URL kommer inn med quotes, og uten en blank quote i forkant s√• tror windows at URL-en skal inn i vindustittelen
  - URL-en til slutt er URL-en som skal √•pnes, som Windows n√• skj√∏nner at skal √•pnes i standardnettleseren

* Android 
** Terminering av help-text
Help-text i minibufferen terminerer linjer som g√•r utenfor skjermen. Det er visstnok for √• bevare ting som meningsfull indentering i kodeeksempler.

Men p√• mobil er det kronglete √• scrolle sidelengs, s√• jeg bytter til ~visual-line-mode~ i den situasjonen slik at lange setninger heller wrapper rundt


#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(when (eq system-type 'android)
    (add-hook 'help-mode-hook #'visual-line-mode))
#+end_src
** App-hurtigtaster

~am~ - Android Manager - p√• Termux kan snakke med Android sitt API og starte apper fra kommandolinja. Det kan Emacs bruke - her er en test som starter opp Gmail: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/android-launch-gmail ()
  "Launch the Gmail app"
      (interactive)
            (shell-command "am start -n com.google.android.gm/.ConversationListActivityGmail"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "l g" #'my/android-launch-gmail)
#+end_src

* Projectile

Legger til mapper jeg ofte s√∏ker gjennom

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! projectile
  (dolist (p '("~/repos/notater"
               "~/repos/ansible-desktop"))
    (projectile-add-known-project p)))
#+end_src

Bytter caching metode fra hybrid til alien, for at nye filer skal bli s√∏kbare med en gang. F√∏r jeg gjorde dette, m√•tte jeg kj√∏re ~projectile-invalidate-cache~ ofte for √• f√• med nye filer

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq projectile-indexing-method 'alien)
#+end_src

Setter opp et advice som gj√∏r at ~projectile-invalidate-cache~ kj√∏res etter hver ~rename-file~, slik at filer med nytt navn er automatisk s√∏kbare i Projectile etter navneendring.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! projectile
  (defun my/rename-file-invalidate-projectile-cache (&rest _)
      (when (and (called-interactively-p 'any)
                       (featurep 'projectile))
                                     (projectile-invalidate-cache nil)))

  (advice-add 'rename-file :after #'my/rename-file-invalidate-projectile-cache))
#+end_src
    
* Org-mode
** Org-ellipsis

~org~ viser i utgangspunktet fram ~[...]~ n√•r tekst skjules under en headline. Gj√∏r den litt mer minimal slik:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! org
  (setq org-ellipsis " ..."))
#+end_src

** Fjerne newlines mellom headere

N√•r man trykker ~TAB~ for √• se headline-oversikten i en fil, s√• beholder org-mode en blank linje under alle headlines som har 2 eller flere newlines helt nederst. Det er ikke nyttig og ser stygt ut, s√• jeg fjerner det:

Det styres av ~setq org-cycle-separator-lines~, som har en veldig god forklaring om man inspect-er variabelen

l√∏ses ved √• settte den til 0

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-cycle-separator-lines 0)
#+end_src

** Fargelegge TODO/DONE osv

Standard-fargene er ikke helt topp, s√• her er noen endringer:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! org
  (setq org-todo-keyword-faces
        '(;;("TODO" . (:foreground "#ffff00" :weight bold))
          ("STRT" . (:foreground "#ffff00" :weight bold))
          ("KILL" . (:foreground "#595e60" :weight bold))
          ("WAIT" . (:foreground "#B4F8C8" :weight bold))
          ("HOLD" . (:foreground "#B4F8C8" :weight bold))
          ("PROJ" . (:foreground "#B4F8C8" :weight bold))
          ;;("DONE" . (:foreground "forest green" :weight bold))
          )))
#+end_src

#+RESULTS:

** CLOSED-property til TODO's
Denne setter opp en "CLOSED" timestamp n√•r en oppgave markeres som DONE:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-log-done 'time)
#+end_src

#+RESULTS:
: time

** Egendefinert filnavn p√• nye org-filer

Org har sin egen m√•te √• lage filnavn p√•, men jeg liker bedre standaradm√•ten sublimeless gjorde det p√•

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/datert-orgfil (title)
  "Create a new Org file with format YYYYMMDDMM Title.org in ~/repos/notater/."
  (interactive "sTitle: ")
  (let* ((timestamp (format-time-string "%Y%m%d%H%M"))
         (filename (format "~/repos/notater/%s %s.org" timestamp title)))
    (find-file filename)))
#+end_src

#+RESULTS:
: my/datert-orgfil

** Org-directory

Forteller Emacs/org-mode hvor det skal letes etter ~.org~-filer:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-directory (expand-file-name "~/repos/notater/"))

(setq org-roam-directory org-directory)
(after! org-roam
  (org-roam-db-autosync-mode))
#+end_src

** Org-capture templates

Org-capture gj√∏r at man kan f√• skrevet inn sm√•notater til en fil uten √• m√•tte √•pne filen.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! org
  (setq org-capture-templates
        '(

          ("1" "Innboks" entry
           (file "~/repos/notater/202012111337 Innboks.org")
           "%?\n" :prepend t))))
#+end_src

** toc-org

toc-org het opprinnelig org-toc, men s√• var det noe navnekonflikter som f√∏rte til navnebytte. Men begge referanser fins fortsatt p√• internett, som gj√∏r at LLM-er refererer til begge deler n√•r man sp√∏r om hjelp.

Denne linja gj√∏r at innholdsfortegnelser tar med statuser som TODO/STRT/DONE o.l., i stedet for standardsettingen som er √• ignorere de
#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-export-with-todo-keywords t)
#+end_src

** deaktivere element cache

N√•r den er aktiv, s√• f√•r jeg feilmeldinger p√• XX n√•r jeg jobber i en buffer som er constrained med ~SPC m s n~ eller ~z n~

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-element-use-cache nil)
#+end_src

Den skal gi performance-√∏kning p√• filer med tusenvis av linjer eller headings. S√• kan ev. aktivere den for s√•nne filer spesifikt.

* Org-agenda

** Global agendaconfig
Fjerner visning av tags og filnavn

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-agenda-remove-tags t)
#+end_src

S√• fjerner jeg alt fra ~org-agenda-prefix-format~. Spesielt ~search~-delen gj√∏r at jeg slipper √• se filbanen til hver TODO. Resten gj√∏r ingenting s√•vidt jeg forst√•r, s√• jeg starter like greit med et blankt utgangspunkt og tilpasser det fra scratch:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-agenda-prefix-format
      '((agenda . "")
        (todo . "")
        (tags . "")
        (search . "")))
#+end_src

Fjerner helpteksten √∏verst i agendaen. Default melding f√∏r jeg fjerna den var dette:

#+begin_quote
Headlines with TAGS match: sprint
Press ‚ÄòC-u r‚Äô to search again
#+end_quote

Fjerner de og erstatter alt med ~" "~. SPC-tegnet gj√∏r at jeg setter inn en blank linje helt p√• topp, for √• f√• litt margin.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-agenda-overriding-header " ")
#+end_src




** Agendaview for spesifikke tags

Setter opp "sprint"-taggen til √• kobles til et eget agendaview, og et annet view for "idag"-tags:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-agenda-custom-commands
      '(("j" "Jobb-sprint" tags-todo "sprint")
        ("i" "dagens oppgaver" tags-todo "idag")))
#+end_src

** Bare vise taggede headlines, ikke sub-headlines
org-agenda har veldig lyst til √• liste opp alle sub-TODOs under de jeg tagger. Fjerner alt som jeg ikke tagger eksplisitt:

- ~my-skip-if-parent-has-tag~ er Claude-vibe for √• gj√∏re akkurat det tittelen sier
- S√• setter jeg en ~org-agenda-custom-commands~ for √• liste opp jobb-oppgaver med en gitt tag, der jeg samtidig kaller skip-funksjonen p√• hver entry.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/skip-if-parent-has-tag (tag)
  "Skip entry if any ancestor has TAG."
  (let ((subtree-end (save-excursion (org-end-of-subtree t))))
    (if (save-excursion
          (while (and (org-up-heading-safe)
                      (not (member tag (org-get-tags)))))
          (member tag (org-get-tags)))
        subtree-end
      nil)))

(setq org-agenda-custom-commands
      '(("j" "Jobb-sprint" tags-todo "sprint"
         ((org-agenda-skip-function '(my/skip-if-parent-has-tag "sprint"))))
        ("i" "dagens oppgaver" tags-todo "idag"
         ((org-agenda-skip-function '(my/skip-if-parent-has-tag "idag"))))))

(setq org-agenda-dim-blocked-tasks nil)
#+end_src

Detaljen med ~org-agenda-dim-blocked-tasks~ m√• med fordi en TODO ansees angivelig som "blokkert" n√•r jeg fjerner nedstr√∏ms oppgaver fra visningen, og da f√•r den dimmed farge. Kan l√∏ses med √• disable dimming i agendaview med √• sette denne til ~nil~.
** Hurtigtaster

Dooms default for √• kalle ~org-agenda~ er ~SPC o A~, som er litt for langt. Setter den til ~SPC A~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "A" #'org-agenda)
#+end_src


** Fjerne visning av repeterende oppgaver

Man kan schedule TODO's til √• repetere seg daglig, som er nyttig til s√•nne sm√• morgenrutine-ting man f.eks. gj√∏r hver morgen p√• jobb.

Men de fyller opp agendavisningen med st√∏y, s√• jeg deaktiverer visning av repetisjonene. Slik at repeterende oppgaver kun vises p√• neste kommende dato:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-agenda-show-future-repeats nil)
#+end_src

* Org-babel
** Ansible-st√∏tte

~org-babel~ st√∏tter ikke Ansible-kode ut fra boksen, men det kan legges til med ~ob-ansible.el~. Jeg klarte ikke finne p√• en smart m√•te √• legge den til, s√• jeg lasta ned ob-ansible fra Github og kopierte kildekoden rett inn i ~/dotfiler/doom/lokal/ob-ansible.el~, og ~require~-er den inn derfra. S√• jeg har en frossen kopi av akkurat denne pakka. Antar jeg la til den ¬¥add-load-path¬¥-setningen f√∏rst for √• f√• Emacs til √• lete etter ~ob-ansible~ i riktig mappe

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el

(add-load-path! "~/.config/doom/lokal")

(after! org
  (require 'ob-ansible)
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((ansible . t)  
     )))
#+end_src

** Eksport til HTML
Hjemmesnekra alternativ til ~org-export-to-html~, som eksporterer til ~/tmp~ i stedet for den versjonskontrollerte mappa jeg vanligvis er i. Ogs√• √•pner den automatisk fila i nettleser

~browse-url~ har jeg moddet [[*√Öpne URL-er i Firefox p√• alle plattformer][her]], s√•nn at den √•pner i nettleser p√• tvers av WSL, Linux og Android

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/org-export-to-tmp-html ()
  (interactive)
  (let ((outfile (concat "/tmp/"
                         (file-name-base (or (buffer-file-name)
                                             (buffer-name)))
                         ".html")))
    (org-export-to-file 'html outfile nil nil nil nil nil)
    (browse-url (if (and (eq system-type 'gnu/linux)
                         (getenv "WSLENV"))
                    (concat "\\\\wsl.localhost\\Ubuntu" outfile)
                  outfile))))
#+end_src
** Eksport til PDF

Dette er den vanlige eksportfunksjonen ~org-latex-export-to-pdf~, pluss...

- Tittel er toppniv√• headline i valgt tekst, i stedet for filnavnet
- PDF-en √•pnes automatisk i nettleser med ~browse-url~ som jeg har moddet tidligere til √• virke bra p√• alle OS-plattformer

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/org-eksport-til-pdf ()
  "Export subtree using headline as title and open in browser."
  (interactive)
  (org-back-to-heading t)
  (let* ((title (nth 4 (org-heading-components)))
         (pdf-file (progn
                     (org-set-property "EXPORT_TITLE" title)
                     (org-latex-export-to-pdf nil t))))
    (when pdf-file
      (browse-url pdf-file))))
#+end_src

** noeksport = notangle

~:noexport:~-taggen gj√∏r at alt nedstr√∏ms headline blir ignorert n√•r man eksporterer til PDF/HTML og andre formater. Mem den har i utgangspunktet ingenting med tangling til konfigfil √• gj√∏re.

Her legger jeg inn et advice p√• ~org-babel-tangle-single-block~-funksjonen, og ber den ignorere alle kodeblokker nedstr√∏ms en :noexport:-tagg.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(advice-add 'org-babel-tangle-single-block :before-while
            (lambda (&rest _)
                          (not (member "noexport" (org-get-tags)))))
#+end_src

* Org-bullets

Gj√∏r headerpunkter finere. Pr√∏vde opprinnelig ~org-modern~, men det inneholdt s√• mye annet rart som ikke funket s√• bra med temaet jeg har. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! org-bullets)
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! org
  (add-hook 'org-mode-hook #'org-bullets-mode))
#+end_src


* Workspaces

Setter opp et utvalg workspaces s√•nn at jeg raskt kan dra fram de vanligste filene jeg vil endre innenfor samme kontekst.

De fleste workspace-ene inneholder delvis sensitive filnavn o.l. pga jobb, s√• de defineres opp i en egen ~.emacs.secrets~-fil som importeres tidligere i denne config-en. Men de f√∏lger samme mal som dette Emacs-config-workspacet:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/workspace-emacs-config ()
  "doom-config + literalfilen de utg√•r fra"
  (interactive)
  (+workspace/new "emacs-config")
  (find-file "~/repos/dotfiler/doom/config.el")
  (find-file "~/repos/dotfiler/doom/init.el")
  (find-file "~/repos/dotfiler/doom/packages.el")
  (find-file "~/repos/dotfiler/emacs-config.org")
  (let ((optional-file "~/.emacs.secrets"))
    (when (file-exists-p optional-file)
      (find-file optional-file)))
  (switch-to-buffer "config.el")
  )
#+end_src






Mal:


#+begin_src emacs-lisp
(defun my/workspace-NAVN ()
  "doom-config + literalfilen de utg√•r fra"
  (interactive)
  (+workspace/new "NAVN"
  (find-file "")
  (find-file "")
  (find-file "")
  (find-file "")
  )
#+end_src

Dette kunne v√¶rt skrevet smartere vha. makroer, parameterisering og s√• videre. Men det funker fint slik det st√•r 

** Activities.el

[[https://github.com/alphapapa/activities.el][Herfra]]

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package activities
  :init
  (activities-mode)
  (activities-tabs-mode)
  ;; Prevent `edebug' default bindings from interfering.
  (setq edebug-inhibit-emacs-lisp-mode-bindings t)

  :bind
  (("C-x C-a C-n" . activities-new)
   ("C-x C-a C-d" . activities-define)
   ("C-x C-a C-a" . activities-resume)
   ("C-x C-a C-s" . activities-suspend)
   ("C-x C-a C-k" . activities-kill)
   ("C-x C-a RET" . activities-switch)
   ("C-x C-a b" . activities-switch-buffer)
   ("C-x C-a g" . activities-revert)
   ("C-x C-a l" . activities-list)))
#+end_src

* Writeroom

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq writeroom-width 50)
#+end_src

* Embark

Aka "action menu super buffer". Det er den som popper opp n√•r man har tastet en halv hotkey, og Emacs venter p√• neste tast. Da ser man alle alternativer. Embark legger til fuzzy search av actions, s√• jeg slipper √• lese gjennom actionlista hver gang i fors√∏k p√• √• finne ting. Ulempen er at jeg -m√•- skrive kommandonavnet i stedet for √• bruke en hotkey, men tror det er best n√•

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq embark-prompter 'embark-completing-read-prompter)
#+end_src

* Hurtiglenker til nettsider
** Epost
√Öpne Gmail- og Outlook-innboksene fra Emacs:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/open-gmail-firefox-tab ()
  "√Öpner Gmail som ny tab i Firefox"
  (interactive)
  (browse-url
   "https://mail.google.com/mail/u/0/#inbox"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/open-outlook-firefox-tab ()
  "√Öpner Outlook som ny tab i Firefox"
  (interactive)
  (browse-url "https://outlook.office.com/mail/"))
#+end_src

** V√¶rmeldinger
*** my/yr-lillebo

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/yr-lillebo ()
  "Open the weather forecast for Lillebo in the system‚Äôs default browser."
  (interactive)
  (browse-url
  "https://www.yr.no/nb/v%C3%A6rvarsel/daglig-tabell/1-174419/Norge/Innlandet/Engerdal/Lillebo"))
#+end_src

*** my/yr-innbygda
#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/yr-innbygda ()
  "V√¶rmelding for Innbygda"
  (interactive)
  (browse-url "https://www.yr.no/nb/v%C3%A6rvarsel/daglig-tabell/1-157692/Norge/Innlandet/Trysil/Innbygda"))
#+end_src

*** my/yr-oslo-christies
#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/yr-oslo-christies ()
  "V√¶rmelding for Oslo"
  (interactive)
  (browse-url "https://www.yr.no/nb/v%C3%A6rvarsel/daglig-tabell/10-995776/Norge/Oslo/Oslo/Christies%20gate"))
#+end_src
*** Hurtigtast til alle v√¶rmeldinger

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("y" . "yr")
       :desc "Lillebo"  "l" #'my/yr-lillebo
       :desc "Innbygda" "i" #'my/yr-innbygda
       :desc "Oslo"     "o" #'my/yr-oslo-christies))
#+end_src

** Kalender
*** Google

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/open-google-kalender-firefox-tab ()
  "√Öpner Google Calendar som ny tab i Firefox"
  (interactive)
  (browse-url "https://calendar.google.com/"))
#+end_src

*** Outlook

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/open-outlook-kalender-firefox-tab ()
  "√Öpner Outlook Calendar som ny tab i Firefox"
  (interactive)
  (browse-url "https://outlook.office.com/calendar/view/week"))
#+end_src

* Magit
** Hotkey: Autocommit med Magit

Jeg committer vanligvis notater med "NN " etterfulgt av my/tidsstempel-sekund.

Det er fortsatt litt for mange steg p√• en mobiltelefon, s√• jeg automatiserer det fram til commitsteget her:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/notatcommit ()
  (interactive)
  (magit-stage-modified)
  (magit-commit-create (list "-m" (concat "NN " (format-time-string "%Y-%m-%d %H:%M:%S")))))
#+end_src

Setter opp hotkey s√• den kan kj√∏res med ~SPC g n~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "g n" #'my/notatcommit)
#+end_src
** Hotkey: git pull & git pull

pull:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "g p" #'magit-pull-from-pushremote)
#+end_src

push: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "g P" #'magit-push-current-to-pushremote)
#+end_src



* Sm√• funksjoner og hurtigtaster
** Markdown-lenker -> Org-lenke

Oversetter lenker fra ~[]()~ til ~[[][]]~ med innhold

regex-en er vibbekoda med Claude. F√∏r regex-en er det noen linjer for √• f√• plassert mark√∏ren p√• rett plass

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/markdown-lenke-til-org ()
  (interactive)
  (beginning-of-line)
  (search-forward "[")
  (backward-char)
  (when (looking-at "\\[\\([^]]+\\)\\](\\([^)]+\\))")
    (replace-match "[[\\2][\\1]]")))
#+end_src

** Funksjon for √• skrive YYYY-MM-DD-TT-MM

Jeg skriver ofte tidsstempler, s√• her er to custom funksjoner for √• til det med en hotkey

To funksjoner for hhv. ~YYYY-MM-DD TT:MM:SS~ og kun ~YYYY-MM-DD~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/tidsstempel-sekund ()
  (interactive)
  "Returnerer tidsstempel som YYYY-MM-DD TT:MM:SS"
  (insert (format-time-string "%Y-%m-%d %H:%M:%S")))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/tidsstempel-dato ()
  (interactive)
  "Returnerer tidsstempel som YYYY-MM-DD"
  (insert (format-time-string "%Y-%m-%d")))
#+end_src

S√• binder jeg de opp mot hver sin hotkey:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! "<S-delete>" #'my/tidsstempel-dato)
(map! "<C-S-delete>" #'my/tidsstempel-sekund)
#+end_src

** Ukenummer til echo area

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/ukenummer ()
  (interactive)
  (let ((now (current-time)))
    (message "Uke %s" (format-time-string "%V" now))))
#+end_src

** M√•le tidsbruk p√• evaluering

Denne er stj√•let [[https://github.com/cloudstreet-dev/Emacs-for-Goodness-Sake/blob/main/04-configuration.md][herfra]]. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defmacro measure-time (&rest body)
  "Measure the time it takes to evaluate BODY."
  `(let ((time (current-time)))
     ,@body
     (message "%.06f seconds"
              (float-time (time-since time)))))
#+end_src

Eksempel p√• bruk:

#+begin_src elisp
(measure-time (sleep-for 5))
#+end_src

Resultat:

#+begin_quote
#+RESULTS:
: 5.000108 seconds
#+end_quote

** Legge inn debugprint i *Messages*-bufferen
:PROPERTIES:
:EXPORT_TITLE: Linjeskift/debugprint i *Messages*-bufferen
:END:

For √• lage luft, og se hvor noe starter og noe annet slutter

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/message-debugprint()
  (interactive)
  (message "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n")
  (message "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n")
  (message "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n"))
#+end_src

* Dirvish

Dirvish sin hurtigmeny er bedre enn bookmarks-funksjonen til Emacs, s√• jeg overstyrer ~SPC RET~ hurtigtasten for det her:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      :desc "Dirvish quick access"
      "RET" #'dirvish-quick-access)
#+end_src

I ~dirvish-quick-access-entries~ kan man liste opp snarveier til filer man bruker ofte, ogs√• kan man hente de raskt ut med ~SPC RET .~. Lista mi inneholder referanser til jobb og fritid, s√• selve lista er definert i ~.emacs.secrets~ og importeres hit under [[*Secrets][Secrets]]-headeren. Ogs√• binder denne elisp-snutten lista opp mot Dirvish

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(after! dirvish
  (when (boundp 'my/dirvish-snarveier)
    (setq dirvish-quick-access-entries my/dirvish-snarveier)))
#+end_src

Skifter ut ~SPC o /~ for √• √•pne filutforskeren med ~SPC o o~, for √• passe bedre med norsk tastatur:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("o" . "open")
       :desc "Open Dirvish (alias SPC o /)" "o" #'dirvish))
#+end_src

* Blamer.el - inline git blame

Tilsvarende GitLens fra VSCode 

Bruker ~blamer.el~: https://github.com/Artawower/blamer.el

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! blamer)
#+end_src

Utgangspunktet er kopi-pasta rett fra README-en

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package blamer
  :bind (("s-i" . blamer-show-commit-info))
  :defer 20
  :custom
  (blamer-idle-time 0.3)
  (blamer-min-offset 70)
  :custom-face
  (blamer-face ((t :foreground "#7a88cf"
                    :background unspecified
                    :height 140
                    :italic t)))
  :config
  (global-blamer-mode 0))
#+end_src

* Startside

Setter Emacs til √• starte opp i et generisk innboksnotat.

~unless~-linja er der fordi jeg av og til har en jobbrelatert fil som oppstartsbuffer. Den settes i s√• fall i en ~.secrets~-fil som lastes tidligere. 

S√• lenge jeg bruker Doom Emacs, s√• er ~initial-buffer-choice~ satt til symbolet ~doom-fallback-buffer~ med mindre jeg har satt den til noe annet. "Noe annet" vil i s√• fall v√¶re en filbane i plaintext. Derfor sjekker jeg om ~initial-buffer-choice~ er en string, og hvis den ikke er det, da setter jeg den til standardfilen nedenfor

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(unless (stringp initial-buffer-choice)
  (setq initial-buffer-choice "~/repos/notater/202012111337 Innboks.org"))
#+end_src

* Nettradio med EMMS

Pr√∏vde opprinnelig √• f√• radiostasjoner inn i ~emms-streams~-lista, men jeg ga opp. Jeg endte opp med √• vibe-kode en egen m√•te √• legge inn radiostasjoner p√•. Det har fungert fint √• bare sette opp en egen funksjon for hver radiokanal, s√•nn at jeg kan starte hver radio med ~M-x kanalnavn~ eller en hotkey. 

NRK-lenkene er henta herfra: https://lyd.nrk.no/. 

** Hvordan hente ut stream-URLs
Noen nettradioer skjuler stream-URL-en. Da kan man ofte f√• tak i den slik:

1) I Firefox: Ctrl+Shift+C for √• f√• opp developer tools
2) Velg ~Network~
3) Filtrer p√• "media" hvis det er mye st√∏y
4) Se etter noe som slutter p√• ~.mp3~, ~.aac~, ~.m3u~ eller lignende
5) Hvis det ikke er noe, kan man skru radioen av og p√• for √• trigge en ny GET-request
   
** Installere EMMS og MPV

Installerer ~emms~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! emms :recipe (:host github :repo "emacsmirror/emms"))
#+end_src

I utgangspunktet kunne jeg bare avkommentert ~emms~ fra ~init.el~-filen, ogs√• hadde Doom-rammeverket installert det automagisk. Men det har vist seg √• v√¶re ustabilt, fordi standardserveren som hoster ~emms~ er under press og svarer ikke regelmessig. Derfor ber jeg om √• hente ~emms~ fra https://github.com/emacsmirror/emms i stedet for http://savannah.gnu.org/, som er standard. 

N√•r det er installert kan jeg be om √• ta i bruk pakka, og peke p√• en mediaspiller som skal brukes til √• spille av lyd. Her er det [[https://mpv.io/][mpv]] som brukes. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package emms
  :defer t
  :config
  (emms-minimalistic)
  (setq emms-player-list '(emms-player-mpv)))
#+end_src

** Hurtigtast: Stoppe radioen
Mapper ~emms-stop~ til ~SPC e s~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "Stopp EMMS" "s" #'emms-stop))
#+end_src

** DEFCON

[[https://somafm.com/player24/station/defcon][soma fm - DEF CON Radio]]

Legger inn stream URL: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-defcon ()
  "Spiller av DEF CON Radio"
  (interactive)
  (emms-play-url "http://ice3.somafm.com/defcon-128-mp3"))
#+end_src

Hurtigtast:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "DEF CON" "d" #'my/radio-defcon))
#+end_src

** NRK Jazz

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-jazz ()
  "Spiller av NRK Jazz"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/jazz_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK Jazz" "j" #'my/radio-nrk-jazz))
#+end_src
** NRK Klassisk

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-klassisk ()
  "Spiller av NRK Klasisk"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/klassisk_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK Klassisk" "k" #'my/radio-nrk-klassisk))
#+end_src

** NRK P1

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-p1 ()
  "Spiller av NRK P1"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/p1_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK P1" "1" #'my/radio-nrk-p1))
#+end_src

** NRK P2

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-p2 ()
  "Spiller av NRK P2"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/p2_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK P2" "2" #'my/radio-nrk-p2))
#+end_src

** NRK P3

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-p3 ()
  "Spiller av NRK P3"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/p3_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK P3" "3" #'my/radio-nrk-p3))
#+end_src

** NRK P13

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-p13 ()
  "Spiller av NRK P13"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/p13_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK P13" "t" #'my/radio-nrk-p13))
#+end_src

** NRK mP3

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-nrk-mp3 ()
  "Spiller av NRK mP3"
  (interactive)
  (emms-play-url "https://cdn0-47115-liveicecast0.dna.contentdelivery.net/mp3_mp3_h"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "NRK mP3" "m" #'my/radio-nrk-mp3))
#+end_src

** Freecodecamp radio

https://coderadio.freecodecamp.org/

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-freecodecamp ()
  "Spiller av freeCodeCamp sin nettradio"
  (interactive)
  (emms-play-url "https://coderadio-admin-v2.freecodecamp.org/listen/coderadio/radio.mp3"))

#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "FreeCodeCamp" "f" #'my/radio-freecodecamp))
#+end_src

** Rainwave

Videospillmusikk. Herfra: https://rainwave.cc//

De har fem ulike kanaler: Chiptune, "games", oc remix, og covers. Denne kanalen er "all", som henter litt fra alle fire

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-rainwave ()
  "Spiller av Rainwave.cc sin nettradio - Videospillmusikk"
  (interactive)
  (emms-play-url "https://relay.rainwave.cc/all.mp3"))

#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "Rainwave" "r" #'my/radio-rainwave))
#+end_src

** Cinemix

Filmusikk. Herfra: https://www.cinemix.us/

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-cinemix ()
  "Spiller av Cinemix sin nettradio - Filmmusikk"
  (interactive)
  (emms-play-url "https://kathy.torontocast.com:1190/stream"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "Cinemix" "c" #'my/radio-cinemix))
#+end_src
** Radio Pays de Gu√©ret

Fransk [[https://www.radiopaysdegueret.fr/][nettradio]] som spiller veldig variert musikk

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-pays-de-gueret ()
  "Spiller av Radio Pays de Gueret - Misc. fransk++"
  (interactive)
  (emms-play-url "https://radiopaysdegueret.ice.infomaniak.ch/radiopaysdegueret.mp3"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "Pays de Gu√©ret" "p" #'my/radio-pays-de-gueret))
#+end_src

** ChilledCow

Nettside: https://liveonlineradio.net/chilledcow

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defun my/radio-chilledcow ()
  "Spiller av ChilledCow radio"
  (interactive)
  (emms-play-url "https://ilm.stream35.radiohost.de/ilm_ilovechillhop_mp3-192"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      (:prefix ("e" . "emms")
       :desc "ChilledCow" "x" #'my/radio-chilledcow))
#+end_src

* gptel
** Installering og aktivering

Installerer gptel-pakka:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! gptel :recipe (:nonrecursive t))
#+end_src

Aktiverer den i Emacs:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package! gptel)
#+end_src

Binder opp ~gptel-send~ og ~gptel-menu~ til hver sin hotkey:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(map! :leader
      "t s" #'gptel-send
      "t m" #'gptel-menu)
#+end_src

** System prompt

Ofte kalt "personalisering"-parameteren. Det er den teksten som mates inn i forkant av hver request, for √• tilpasse oppf√∏rselen til AI-en.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defvar gptel-systemmelding
  "Please keep it short and to the point.

Use bullet points when that can make complex matter easier to read.

Do not start sentences with compliments and phrases like \"aha, good question\" - just reply without this emphasis.

Do not engage in any form of flattery or syncophancy.

Assume I misunderstand basic facts from time to time, and try to make me aware of this

If I send you this and nothing else: \"foobar\", then reply only with the word \"baz\".

Actively try to prove me wrong

Recommend a book from time to time. Always double check that any book mentioned exists in real life

Always reply in English even though I ask you questions in Norwegian, unless specifically asked to reply in Norwegian

Avoid filler text. It is OK if that makes the responses look \"cold\" or detached")
#+end_src

Lager en preset i gptel-configen her:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(gptel-make-preset 'standard-test
  :system gptel-systemmelding)
#+end_src

Setter den som standard ved boot:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(gptel--apply-preset 'standard-test)
#+end_src

Noen ganger har jeg lurt p√• om systemmeldingen i det hele tatt blir lest og tatt i bruk. Da har jeg byttet til ~emoji-preset~ nedenfor her som et debugging-verkt√∏y, for da blir det ganske √•penbart om AI-en f√∏lger instruksen eller ikke

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(defvar gptel-emojitest "only reply with emojis and nothing else")

(gptel-make-preset 'emoji-preset
  :system gptel-emojitest)
#+end_src

** Claude: Installering og autentisering
Som default bruker ~gptel~ bare ChatGPT-modellene. Legger inn Anthropic sine Claude-modeller ogs√•, og setter ~claude-3-haiku~ til √• v√¶re default modell i stedet for ChatGPT sin modell.

API-n√∏kkelen til Claude har jeg lagret i en ~~/.authinfo~-fil, som oppdages automatisk av ~auth-source-pick-first-password~-funksjonen:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(gptel-make-anthropic "Claude"
  :stream t
  :key (auth-source-pick-first-password :host "api.anthropic.com"))
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq gptel-backend (gptel-make-anthropic "Claude"
                 :stream t
                 :key (auth-source-pick-first-password :host "api.anthropic.com")))
#+end_src

Setter ~haiku~-modellen til √• v√¶re standardvalget, da den koster ca. 0 kroner i bruk. 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq gptel-model 'claude-3-haiku-20240307)
#+end_src

** Misc 

Setter org-mode som standardsyntax over Markdown som er default:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq gptel-default-mode #'org-mode)
#+end_src


* ibuffer

Doom Emacs-rammeverket bruker [[https://www.nerdfonts.com/][Nerd Fonts]] for √• trylle fram symboler til alt mulig. Bortsett fra ~ibuffer~, som er veldig gr√• og trist. 

[[https://github.com/seagle0128/nerd-icons-ibuffer][nerd-icons-ibuffer]] legger til ikoner p√• alle filnavn i ~ibuffer~, basert p√• den samme Nerd Font-en man allerede har installert. Den tar seg ogs√• av fargelegging av kolonner, og legger til s√•kalt human-readable filst√∏rrelser i stedet for √• oppgi alt i bits.  

Installerer pakken: 

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! nerd-icons-ibuffer) 
#+end_src

Setter opp en hook som aktiverer ~nerd-icons-ibuffer-mode~ n√•r ~ibuffer~ √•pnes. Med mindre jeg er p√• Emacs p√• Android eller WSL, hvor jeg ikke har f√•tt det til √• virke.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(use-package! nerd-icons-ibuffer
  :unless (eq system-type 'android)
  :unless (and (eq system-type 'gnu/linux) (getenv "WSLENV"))
  :hook (ibuffer-mode . nerd-icons-ibuffer-mode))
#+end_src

Flisespikker p√• sm√•detaljer:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq nerd-icons-ibuffer-icon-size 1.2)
#+end_src

* Testing :noexport:
** Skille mellom Windows og Linux

En del innstillinger m√• tilpasses OS-et. Setter opp en global variabel for dette, s√•nn at jeg slipper √• sjekke dette gjentatte ganger lengre ned:

~system-type~ er en innebygd variabel som returnerer navnet:


#+begin_src elisp
(message "%s" system-type)
#+end_src

#+RESULTS:
: gnu/linux

Men p√• Windows kj√∏rer jeg fortsatt Emacs gjennom WSL, som betyr at jeg f√•r returnert ~gnu-linux~ her ogs√•. For √• finne ut om det er WSL kan vi lage en kjapp deteksjonsfunksjon:

#+begin_src elisp
(defconst my/is-wsl
  (and (eq system-type 'gnu/linux)
       (string-match "WSL" (string-trim (shell-command-to-string "uname -r")))))

(cond
 (my/is-wsl     (message "Running under WSL")))
#+end_src

#+RESULTS:
: Running under WSL

** hotkey ny headline + indentere

#+begin_src emacs-lisp
(defun my/org-insert-subheading ()
  "Insert a new subheading below, position cursor after a space, ready for input."
  (interactive)
  (org-insert-heading)
  (org-metaright)
  (end-of-line)                 ;; go to end of heading stars
  (insert " ")                  ;; add a space
  (evil-insert-state))          ;; switch to insert mode
  #+end_src


m√• bli kvitt den ekstra
** Persistent workspaces

Ikke innf√∏rt enda, men jeg fant denne snippet-en fra en annens config som visstnok skal funke:

;; Trying to save workspaces
(after! persp-mode
  ;; Auto-save workspaces when Emacs exits
  (setq persp-auto-save-opt 1)
  ;; Save all workspace info including window configurations
  (setq persp-set-last-persp-for-new-frames nil)
  (setq persp-reset-windows-on-nil-window-conf nil)
  ;; Load workspaces automatically on startup
  (setq persp-auto-resume-time -1))

** Dimme inaktive vinduer
funker ikke, tror det skjedde noe galt da Emacs pr√∏vde √• klone ned dimmer.el og brukte en evighet p√• det


# I tilegg dimmer jeg inaktive vinduer med ~dimmer.el~


# #+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
# (package! dimmer)
# #+end_src

# Config:
# #+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
# (use-package! dimmer
#   :config
#   (dimmer-mode)
#   (setq dimmer-fraction 0.3))  ;; 30% dim on inactive windows
# #+end_src
** M-x my/emoji-numpad


#+begin_src emacs-lisp
(defvar my/emoji-numpad-map
  '((7 . "üìÅ") (2 . "üç∫") (6 . "üëç") (5 . "üåû"))
  "Mapping from numbers to emojis for `my/emoji-numpad'.")

(defun my/emoji-numpad ()
  "Prompt for a number; insert mapped emoji, else say 'undefined' in echo area."
  (interactive)
  (let* ((n (read-number "Enter a number: "))
         (emoji (alist-get n my/emoji-numpad-map)))
    (if emoji
        (insert emoji)
      (message "undefined"))))
#+end_src

oi det var lett
neste steg kan v√¶re √• f√• opp ei synlig liste √• velge fra

** Org-present

Herfra: https://github.com/rlister/org-present

#+begin_src emacs-lisp
(package! org-present)
#+end_src

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(eval-after-load "org-present"
  '(progn
     (add-hook 'org-present-mode-hook
               (lambda ()
                 (org-present-big)
                 (org-display-inline-images)
                 (org-present-hide-cursor)
                 (org-present-read-only)))
     (add-hook 'org-present-mode-quit-hook
               (lambda ()
                 (org-present-small)
                 (org-remove-inline-images)
                 (org-present-show-cursor)
                 (org-present-read-write)))))

(after! org-present
  (setq org-present-level 99))  ;; 2 = * and ** are slides
#+end_src
* Legacy :noexport:
:PROPERTIES:
:header-args:    :tangle no
:END:
** Deaktiver truncate lines :noexport:

2025-12-09 tror jeg bare la inn denne for √• fikse en hack-feil jeg rettet opp rot√•rsaken p√• senere. Det var noe gammel vibeconfig som jeg sletta. 

Denne mener jeg er ~nil~ som standard, men p√• et tidspunkt begynte setninger √• flyte ut av skjermen uten at jeg ville det. Denne setningen sikrer at linjer blir truncated

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
;(setq-default truncate-lines nil)
#+end_src
** Scratchbuffergreier
2025-12-09 Tror dette aldri ble tatt i bruk/hadde noen innvirkning p√• Emacs:



Scratch-bufferen bruker jeg lite, men n√•r den brukes s√• er det for √• leke med Lisp. S√• jeg setter grunnmodusen der til ~lisp-interaction-mode~ i stedet for Fundamental



#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq initial-major-mode 'lisp-interaction-mode)

(setq +scratch-default-mode 'lisp-interaction-mode)
#+end_src

;; Make the startup *scratch* buffer use lisp-interaction-mode


** Erstatt ~ESC~ med ~nk~ for √• avslutte visual/insert mode

2025-12-09: Dette stammer fra da jeg pr√∏vde √• finne et bedre alternativ til ~ESC~-knappen


Lillefingeren min liker ikke √• pendle tur-retur ESC to hundre ganger hver dag. "oi" tror jeg vil funke bra fordi jeg alltid har ringfinger og langfinger hvilkende p√• de som standard.

Jeg mapper ikke egentlig ESC til noe annet her, men jeg setter opp en hotkey som oppn√•r det samme som ESC oppn√•r n√•r jeg er i insert mode, som er √• ta meg tilbake til normal mode

Installerer ~key-chord~:

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/packages.el
(package! key-chord)
#+end_src

Bruker ~key-chord-mode~ for √• sette opp "oi" som alternativ til ESC

...men har problemer med √• f√• det til √• virke konsekvent

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(require 'key-chord)
(key-chord-mode 1)
;; (key-chord-define evil-insert-state-map "oi" 'evil-normal-state)
;; (key-chord-define evil-visual-state-map "oi" 'evil-normal-state)
(setq key-chord-two-keys-delay 0.2)
#+end_src

- ~evil-insert-state-map~ sier at f√∏lgende hotkey gjelder kun n√•r jeg er i insert mode
- ~'evil-normal-state~ er funksjonen som kalles n√•r jeg taster "kj"
  - Med andre ord, den sier "ta meg tilbake til normal mode"
- ~key-chord-two-keys-delay~ setter max tillatt ventetid mellom de to tastene for at det skal telle som en hhttps://github.com/rnkn/olivetti?tab=readme-ov-fileotkey

...og her deaktiverer jeg esc til √• g√• ut av insert mode, slik at jeg ikke glemmer √• bruke den nye hotkey-en. kan slette denne etterhvert som jeg internaliserer ~nk~.

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
;; (after! evil
;;     (define-key evil-insert-state-map (kbd "<escape>") 'ignore)
;;     (define-key evil-visual-state-map (kbd "<escape>") 'ignore))
#+end_src

** Org-refile :noexport:
:PROPERTIES:
:EXPORT_TITLE: Org-refile
:END:

2025-12-11 22:42:36 :noexport: fordi jeg tror denne ikke gj√∏r noe som helst

#+begin_src emacs-lisp :tangle ~/repos/dotfiler/doom/config.el
(setq org-refile-targets
      '(("~/repos/notater/202111121500 Innboks jobb.org" :maxlevel . 1)
        ("~/repos/notater/202012111337 Innboks.org" :level . 1)))
#+end_src
